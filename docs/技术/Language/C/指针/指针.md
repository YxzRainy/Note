---
title: C 指针
date: 2022-02-17
categories:
        - Note
tags:
        - C
        - 指针
---

# 指针

如果有一个变量专门来存放另一变量的地址（指针），则该变量就是指针变量。指针变量的值就是指针。

指针是一个地址，地址是内存单元的编号，它是一个从零开始的非负整数；比如在 32 位系统中，地址的取值范围是 0 — 4 G（4095）。

指针本质就是一个操作受限的非负整数。

**指针只能进行减法运算，不能进行加乘除等运算。**

八位（Bit）是一个字节，一个字节就是一个内存单元。

`int*` 是 **指向整型变量的指针**。

一个指针包含三个信息

1. 表示内存编号的纯地址
2. 指针类型
3. 基类型，本身存储单元应该存储什么样的数据类型。

## 作用

1. 表示一些复杂的数据结构（树、图）。

2. 快速的传递数据，并且减少了内存的耗费。

3. 使函数返回一个以上的值。

4. 可以直接访问硬件。

5. 更方便的处理字符串（'\0'）。

## 引用变量

直接引用，将 i 变量赋值给 a 变量， 然后可以通过 a 变量直接访问 i 变量。。

间接引用，将 i 变量的地址赋给 i_pointer，然后访问 i_pointer，就可以找到 i 变量。

## 理解指针

```c
#include <stdio.h>

int main() {
	int a = 1, b = 2;
	int* pointer;
	pointer = &a;
	printf("%d\n", *pointer);
	printf("%d\n", pointer);

	return 0;
}
```

- `pointer` 是一个指针变量，它的值是变量a的地址，也就是a在内存中的位置。
- `*pointer` 是一个取内容运算符，它的作用是访问 pointer 中地址所指向的变量的值，也就是 a的值。

## 指针变量定义

指针变量 `*pointer` 中的 `*` 表示该变量为指针型变量，`pointer` 才是指针变量名。

定义指针变量必须指定其基本类型。

指针变量不仅包括变量的地址，还包括变量的类型信息。

指针变量只能存放一个地址 `&`，而不能存放一个整型数值

### 代码解析

```C
#include <stdio.h>

int main () {
	int * p;
//   定义一个指针变量 p，且这个 p 只能存放 int 类型的地址，
	int i = 20;
	p = &i;
//   &i 表示获取变量 i 的内存地址
//这时候 p 中，存放的就是指向变量 i 的内存地址，则 p 完全等同于 i.

	int j = * p;
	printf("i = %d ,j = %d \n",i,j);

	return 0;
}
```

### 详解 \*p

```c
#include <iostream>
int main()
{
    int * p;
    int i = 5;
    p = &i;
//  p 保存了 i 的地址
//  修改 p 不会影响 i；修改 i 也不会影响 p，因为他们是不同的变量。
//  *p = i，此时，修改 *p 就是修改 i，修改 i 就是修改 *p
//  更准确的说，*p 是以 p 的内容为地址的变量。
    *p = 99;
    printf("i = %d,p = %d \n",i,*p);
    i = 88;
    printf("i = %d,p = %d \n",i,*p);
}
```

 

## 一个指针变量占几个字节

在 64 位系统中，一个指针变量占 4 个字节，不管这个指针指向的是什么类型的变量。

在 64 位系统中，一个指针变量占 8 个字节，不管这个指针指向的是什么类型的变量。

### sizeof()

此函数可以返回指定数据类型所占的字节。

```c
#include <stdio.h>

int main ()
{
    int a = 666;
    char ch = 'A';
    double dou = 99.9;
    int*p = &a;
    char *c = &ch;
    double *x = &dou;
    // 不过什么数据类型的指针变量，
    // 所占字节都是 8 个（32 位系统占 4 个字节）
    printf("%d\n",sizeof(p));
    printf("%d\n",sizeof(c));
    printf("%d\n",sizeof(x));
}
```

虽然在 64 位系统中的指针变量占 8 个字节，但是一个变量的地址（指针变量）只会存放该变量首字节的地址。这样，指针变量通过首字节的地址，就能知道自己所指向的变量类型，也就知道了该指针变量所指向的变量到底占多少个字节。

虽然一个指针变量所指向的变量的所占字节大小不一样，但是这个指针变量，**无论它指向的变量占多少个字节，该指针变量本身只会且仅占 4 个字节。**

## 指针的运算

指针变量不能相加不能相乘也不能相除，但可以相减。

如果两个指针变量指向的是同一块连续空间中的不同存储单元（比如数组），则这两个指针变量才可以相减或相互比较（表示两个元素相隔多少个元素/字节）
