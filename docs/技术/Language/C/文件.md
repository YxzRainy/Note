---
title: C 文件
date: 2023-04-03
categories:
        - Note
tags:
        - C
        - 文件
---

# 文件

程序文件，文件内容是程序代码

数据文件，文件内容是供程序运行时读写的数据。

数据流，数据从源到目的端的流动，文件由操作系统管理

## 数据文件分类

为 ASCII 文件（文本文件）和 二进制文件（映像文件）。

## 文件缓冲区

系统自动的早内存区为程序中每一个正在使用的文件开辟一个文件缓冲区。

文件缓冲区是用以**暂时存放读写期间的文件数据而在内存区预留的一定空间**。使用文件缓冲区可以缓和 CPU 和 I/O 设备之间速度不匹配的矛盾，减少读取硬盘的次数。

## 文件指针

每个被使用的文件都在内存中能开辟一个相应的文件信息区，用来存放文件的有关信息。

这些信息被保留在一个结构体变量中，该结构体时系统声明的，名为 FILE。不同编译器下的 FILE 内容是不同的。

FILE 被包含在 `stdio.h` 头文件中，因此可以直接使用。但一般不通过 FILE 的名字来引用 FILE，而是声明一个**指向 FILE 的指针变量**，然后通过它来引用这些 FILE 类型的变量。这个指针变量就是**文件指针**。

## 打开与关闭文件

打开文件就是建立文件的信息区和缓冲区（暂存输入输出的数据）

关闭文件就是撤销文件信息区和缓冲区，使文件指针不在 指向该文件。

### fopen(文件名,使用文件方式)

以指定的使用文件的方式打开一个文件

### 使用文件方式

r，为了输入数据，打开一个已存在的文本文件。

r+，为了读写，打开一个文本文件

w，为了输出数据，打开一个文本文件

w+，为了读写，创建一个新的文本文件

a，向文本文件末尾添加数据

a+，为了读写，打开一个文本文件

rb，只读，为了输入数据，打开一个二进制文件

rb+，读写，打开一个二进制文件。文件必须存在，否则打开失败。

wb，只写，为了输出数据，打开一个二进制文件

wb+，读写，建立新的二进制文件

ab，向二进制文件末尾添加

ab+，为读写打开一个二进制文件

### fclose(文件指针) 

关闭数据文件。使用完一个文件后应该关闭它，防止被误用

## 顺序读写数据文件

对文件的读写顺序和数据在文件中的物理顺序是一致的。

### 读写一个字符的函数

fgetc(fp)，从 fp 指向的文件读入一个字符。读成功，返回所读字符，失败则返回文件结束标志 EOF。

fputc(ch,fp)，把字符 ch 写入到文件指针变量 fp 所指向的文件中。写成功，返回输出的的字符，失败则返回 EOF

### 读写一个字符串的函数

fgets(str,n,fp)，从 fp 指向文件读入一个长度为 （n - 1）的字符串，存放到字符数组 str 中。成功则返回地址 str，失败返回 NULL

fputs(str,fp)，将 str 所指向的字符串写到文件指针变量 fp 中。输出成功返回 0，否则返回 非 0 值。

### 用二进制方式向文件读写一组数据

从文件中读写一个数据库

**fread(buffer,size,count,fp)**

**fwrite(buffer,size,count,fp)**

1. 对 fread 来说，buffer，一个地址，用来存放从文件读入数据的存储区的地址。
2. 对 fwrite 来说， buffer，将起始地址开始存储区中的数据想文件输出。
3. size，要读写的字节数。
4. count，要读写多少个数据项。
5. fp，FILE 类型的指着。

### 文件打开方式

文本方式，不带 b 的方式，读写文件时对换行符进行转换。

二进制方式，带 b 的方式，读写文件时对换行符不进行转换。

## 随机读写数据文件

不按照数据在文件中的物理位置次序进行读写，而是可以对任何位置上的数据进行访问。比顺序读写的效率高很多。

### 文件位置标记

文件位置标记是一个用来指示文件中下一个要读写的字符的位置的标识1。它可以随着文件的读写操作而自动或者人为地移动，从而实现对文件的随机访问

### 文件位置标记的定位

可以强制使文件位置标记指向人们指定的位置。

rewind(fp) ，使文件位置标记重新返回文件开头。

fseek(文件指针，位移量，起始点) ，改变文件位置标记。

1. 起始点用 0（开始位置）、1（当前位置）、2（末尾位置） 替代。
2. 位移量是以起始点为基点，向前移动到字节数。应为 long 类型

ftell()，获得流式文件中文件位置标记的当前位置

### 随机读写

用 rewind() 和 fseek() 函数实现随机读写

## 文件读写出错检测

检查输入输出函数调用时可能出现的错误。

ferror(fp)，返回 0 ，则文件读写未出错；非零值，则表示出错。执行 fopen() 后，ferror() 初始值为 0。

clearerr(fp)，是文件出错标志和文件结束标志设置为 0。当调用 ferror() 检测到一个文件出错后，ferror() 的值会变为非零值，此时应该立即调用 clearerr(fp)，使 ferror(fp) 的值变为 0，以便进行下一次检测

