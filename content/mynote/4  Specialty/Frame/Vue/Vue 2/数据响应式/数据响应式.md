---
title: Vue 数据响应式
date: 2022-05-19 6:00:00
updated: 2022-05-19 6:00:00
categories:
        - 前端框架
tags:
        - Vue
        - 前端
        - Vue 2
        - 学习笔记
---

# 数据响应式

Vue 会监视 data 中所有层级的数据。

## 数据劫持

指的是在访问或者修改对象的某个属性时，通过一段代码拦截这个行为，进行额外的操作或者修改返回结果。

在 Vue  中，是通过给对象添加一个`setter()`来实现的数据劫持这个行为的。

## 如何响应对象中的数据？

通过 `setter()`实现响应，且要在 nwe Vue 时就传入要响应的数据。

- new Vue 之后再追加的对象属性，Vue 默认不响应。
- 若需要让 Vue 响应 new Vue 之后追加的对象属性，需要使用 `Vue.set()`或则 `vm.$set()`

## 如何响应数组中的数据？

通过**包裹数组更新元素的方法**实现：

- 调用原生更新元素的方法实现对数组进行更新。
- 重新解析模板，进而更新页面。

原生数组被包裹的方法有：

- `push()`
- `pop()`
- `shift()`
- `unshift()`
- `splice()`
- `sort()`
- `reverse()`

只要使用以上方法更新数组中的元素，那么就可以实现响应数组中的数据。

## 不完整的数据响应式实现

```js
// 模仿 Vue 实现响应式的过程，
// 缺陷一：无法直接 vm.attr
// 缺陷二：多层级的属性无法被监听到
var data = {
	name: '黔灵山',
	address: '贵阳',
	age: 35,
};

// 创建一个监视的实例对象，用于监视 data 中属性的变化

var obs = new Observer(data);

// 此时 data 中有的属性，obs 中都有。

// 定义一个 vm 实例对象
var vm = {};
vm._data = data = obs;

function Observer(obj) {
	// 汇总对象中所有的属性，并形成一个数组
	var keys = Object.keys(obj);
	// 遍历
	keys.forEach((k) => {
		Object.defineProperty(this, k, {
			get() {
				return obj[k];
			},
			set(val) {
				console.log('值被修改');
				obj[k] = val;
			},
		});
	});
}

```

