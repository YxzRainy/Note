---
title: C malloc
date: 2022-04-03
categories:
        - 编程语言
tags:
        - C
        - 指针

---

# malloc

malloc 是 memory（内存）allocate（分配）的缩写。

可以让一个变量动态分配内存。

## malloc 函数的使用

```c
#include <iostream>
#include <malloc.h>

int main()
{
    int a = 5; // a 是一个 int 变量，它是静态分配的
    int * p = (int *)malloc(4); // 动态分配
    *p = 5;// *p 也是一个 int 变量，但它是动态分配的
    free(p); // 手动释放动态分配的内存
    printf("%d\n",*p);
    printf("%d\n",p);
}
```

1. 使用 malloc 函数，需要添加头文件 malloc.h
2. malloc 函数只有一个形参，并且形参是整型。
3. `malloc(4)`表示请求系统为我们分配 4 个字节
4. malloc 函数只能返回第一个字节的地址，**即 p 只保存了第一个字节的整型地址**
5. `int *` 是为了让系统知道我们分配这个 4 个字节的地址是整型地址。
6. `int * p = (int *)malloc(4)`这行代码总共分配了 8 个字节，`int * p`分配了 4 个字节，`(int *)malloc(4)`分配了 84 个字节一共 8 个字节。
7. p（`int * p`）本身所占的内存是静态分配的，但 p 所指向的内存`(int *)malloc(4)`是动态分配的。
8. `free(p)`表示**将 p 所指向的内存给释放掉**，使得 p 指向的内存无法被读写。但是，p 本身的内存是静态的，不能被我们用`free()`函数手动释放，p 本身的内存只能在 p 变量所在的函数运行结束后，被系统自动释放。
9. `*p = 5`和`int a = 5`的区别在于前者的内存分配方式是动态分配的，后者的内存分配方式是静态分配的。
10. `*p = 5` 中，其中`*p`指的是用`(int *)malloc(4)`动态分配了 4 个字节的内存空间，而`*p = 5`，则是将 5 这个 int 数值放入这动态分配的 4 个字节的内存中。而 p 则只保存了其中第 1 个字节的地址。
